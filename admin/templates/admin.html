<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Админ-панель сказок</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      h1,
      h2 {
        color: #333;
      }
      form {
        margin-bottom: 20px;
      }
      input,
      textarea,
      select {
        width: 100%;
        margin: 5px 0;
        padding: 8px;
        font-size: 16px;
      }
      button {
        padding: 8px 15px;
        font-size: 16px;
      }
      .level-buttons button {
        margin: 5px;
      }
      .tales-container {
        display: none;
      }
      .tales-container.active {
        display: block;
      }
      .tale-item {
        margin-bottom: 10px;
        border-bottom: 1px solid #ccc;
        padding-bottom: 5px;
      }
      .pagination {
        margin-top: 10px;
      }
      .pagination button {
        margin: 2px;
      }
    </style>
  </head>
  <body>
    <h1>Добавить сказку</h1>
    <form method="POST">
      <input
        type="text"
        id="title"
        name="title"
        placeholder="Название"
        required
      />
      <input type="text" id="slug" name="slug" placeholder="Slug" required />
      <select name="level" required>
        <option value="">Выбери уровень</option>
        <option value="A1">A1</option>
        <option value="A2">A2</option>
        <option value="B1">B1</option>
        <option value="B2">B2</option>
      </select>
      <textarea name="text" placeholder="Текст сказки" required></textarea>
      <input
        type="text"
        name="audio_url"
        placeholder="Ссылка на аудио (необязательно)"
      />
      <button type="submit">Добавить</button>
    </form>

    <h2>Список сказок</h2>
    <div class="level-buttons">
      <button onclick="showLevel('A1')">A1</button>
      <button onclick="showLevel('A2')">A2</button>
      <button onclick="showLevel('B1')">B1</button>
      <button onclick="showLevel('B2')">B2</button>
    </div>

    {% for level in ['A1', 'A2', 'B1', 'B2'] %}
    <div class="tales-container" id="level-{{ level }}">
      {% set tales_by_level = tales | selectattr("level", "equalto", level) |
      list %} {% for tale in tales_by_level %}
      <div class="tale-item page-{{ level }}-{{ loop.index0 // 5 }}">
        <strong>{{ tale.title }}</strong> ({{ tale.level }})
        <form
          method="POST"
          action="/admin/delete/{{ tale.id }}"
          style="display: inline"
        >
          <button type="submit">Удалить</button>
        </form>
      </div>
      {% endfor %}
      <div class="pagination" id="pagination-{{ level }}"></div>
    </div>
    {% endfor %}

    <script>
      document.getElementById("title").addEventListener("input", function () {
        const slug = this.value
          .toLowerCase()
          .replace(/[^a-z0-9а-яё\s]/gi, "")
          .trim()
          .replace(/\s+/g, "-");
        document.getElementById("slug").value = slug;
      });

      function showLevel(level) {
        document
          .querySelectorAll(".tales-container")
          .forEach((el) => el.classList.remove("active"));
        const container = document.getElementById("level-" + level);
        container.classList.add("active");
        showPage(level, 0);
      }

      function showPage(level, page) {
        document
          .querySelectorAll(`.page-${level}-*`)
          .forEach((el) => (el.style.display = "none"));
        const tales = document.querySelectorAll(`.page-${level}-${page}`);
        tales.forEach((el) => (el.style.display = "block"));

        const total = document.querySelectorAll(
          `[id="level-${level}"] .tale-item`
        ).length;
        const totalPages = Math.ceil(total / 5);
        const pagination = document.getElementById(`pagination-${level}`);
        pagination.innerHTML = "";
        for (let i = 0; i < totalPages; i++) {
          const btn = document.createElement("button");
          btn.innerText = i + 1;
          btn.onclick = () => showPage(level, i);
          pagination.appendChild(btn);
        }
      }

      // Показать уровень A1 по умолчанию
      showLevel("A1");
    </script>
  </body>
</html>
