<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <style>
      /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞–≤–∏–ª –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–µ, —á—É—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–ª */
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f4f6f8;
        margin: 0;
        padding: 40px;
        color: #333;
      }
      h1,
      h2 {
        color: #2c3e50;
      }
      .container {
        display: flex;
        flex-wrap: wrap;
        gap: 40px;
      }
      .card {
        background: #fff;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        width: 100%;
        max-width: 500px;
      }
      form {
        display: flex;
        flex-direction: column;
      }
      input,
      textarea,
      select {
        width: 100%;
        padding: 10px;
        margin: 8px 0;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      button {
        background-color: #2ecc71;
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        align-self: flex-start;
      }
      button:hover {
        background-color: #27ae60;
      }
      .top-buttons {
        margin-bottom: 20px;
      }
      .top-buttons button {
        background-color: #3498db;
        margin-right: 10px;
        padding: 8px 14px;
        font-weight: bold;
        border: none;
        color: white;
        border-radius: 4px;
        cursor: pointer;
      }
      .top-buttons button:hover {
        background-color: #2980b9;
      }
      .tales-container,
      .stories-container {
        display: none;
      }
      .tales-container.active,
      .stories-container.active {
        display: block;
      }
      .item {
        padding: 10px;
        margin-bottom: 10px;
        background: #fff;
        border-left: 4px solid #3498db;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .item button {
        background-color: #e74c3c;
        padding: 6px 12px;
      }
      .item button:hover {
        background-color: #c0392b;
      }
    </style>
  </head>

  <body>
    <div class="top-buttons">
      <button onclick="switchMode('tales')">üè∞ –°–∫–∞–∑–∫–∏</button>
      <button onclick="switchMode('stories')">üìò –†–∞—Å—Å–∫–∞–∑—ã</button>
    </div>

    <div class="container">
      <div class="card">
        <h1 id="form-title">–î–æ–±–∞–≤–∏—Ç—å —Å–∫–∞–∑–∫—É</h1>
        <form id="add-form" method="POST" action="/admin/add">
          <input
            type="text"
            id="title"
            name="title"
            placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"
            required
          />
          <input
            type="text"
            id="slug"
            name="slug"
            placeholder="Slug"
            required
          />
          <select id="level" name="level" required>
            <option value="">–í—ã–±–µ—Ä–∏ —É—Ä–æ–≤–µ–Ω—å</option>
            <option value="A1">A1</option>
            <option value="A2">A2</option>
            <option value="B1">B1</option>
            <option value="B2">B2</option>
          </select>
          <select id="genre" name="genre" required>
            <!-- –∂–∞–Ω—Ä—ã –±—É–¥—É—Ç –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          </select>
          <textarea name="text" placeholder="–¢–µ–∫—Å—Ç" required></textarea>
          <input
            type="text"
            id="audio_url"
            name="audio_url"
            placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∞—É–¥–∏–æ"
          />
          <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
        </form>
      </div>

      <div class="card">
        <h2>–°–ø–∏—Å–æ–∫</h2>

        <div class="tales-container" id="tales-list">
          {% for tale in tales %}
          <div class="item">
            <strong>{{ tale.title }}</strong> ({{ tale.level }}, {{ tale.genre
            }})
            <form method="POST" action="/admin/delete/{{ tale.id }}">
              <button type="submit">–£–¥–∞–ª–∏—Ç—å</button>
            </form>
          </div>
          {% endfor %}
        </div>

        <div class="stories-container" id="stories-list">
          {% for story in stories %}
          <div class="item">
            <strong>{{ story.title }}</strong> ({{ story.level }}, {{
            story.genre }})
            <form method="POST" action="/admin/delete-story/{{ story.id }}">
              <button type="submit">–£–¥–∞–ª–∏—Ç—å</button>
            </form>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <script>
      const slugInput = document.getElementById("slug");
      const levelSelect = document.getElementById("level");
      const audioUrlInput = document.getElementById("audio_url");
      const genreSelect = document.getElementById("genre");
      const formTitle = document.getElementById("form-title");

      const BASE_AUDIO_URL = "https://moki-audio.vercel.app/";

      const genresTales = [
        "Cuento cl√°sico",
        "Cuento de hadas",
        "F√°bula",
        "Cuento de animales",
        "Cuento de aventuras",
        "Cuento de humor",
        "Cuento de terror",
      ];

      const genresStories = [
        "Aventura",
        "Terror",
        "Humor",
        "Amistad",
        "Viajes",
        "Medicina",
        "Tecnolog√≠a",
      ];

      function updateSlug() {
        const slug = document
          .getElementById("title")
          .value.toLowerCase()
          .replace(/[^a-z0-9–∞-—è—ë\s]/gi, "")
          .trim()
          .replace(/\s+/g, "-");
        slugInput.value = slug;
        updateAudioUrl();
      }

      function updateAudioUrl() {
        const slug = slugInput.value.trim();
        const level = levelSelect.value.trim().toLowerCase();
        if (slug && level) {
          audioUrlInput.value = `${BASE_AUDIO_URL}${level}/${slug}.ogg`;
        } else {
          audioUrlInput.value = "";
        }
      }

      function switchMode(mode) {
        if (mode === "tales") {
          formTitle.innerText = "–î–æ–±–∞–≤–∏—Ç—å —Å–∫–∞–∑–∫—É";
          fillGenreOptions(genresTales);
          document.getElementById("tales-list").classList.add("active");
          document.getElementById("stories-list").classList.remove("active");
          document.getElementById("add-form").action = "/admin/add";
        } else {
          formTitle.innerText = "–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Å–∫–∞–∑";
          fillGenreOptions(genresStories);
          document.getElementById("stories-list").classList.add("active");
          document.getElementById("tales-list").classList.remove("active");
          document.getElementById("add-form").action = "/admin/add-story";
        }
      }

      function fillGenreOptions(genres) {
        genreSelect.innerHTML = "";
        genres.forEach((genre) => {
          const option = document.createElement("option");
          option.value = genre;
          option.innerText = genre;
          genreSelect.appendChild(option);
        });
      }

      document.getElementById("title").addEventListener("input", updateSlug);
      levelSelect.addEventListener("change", updateAudioUrl);
      slugInput.addEventListener("input", updateAudioUrl);

      // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–∫–∞–∑–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      switchMode("tales");
    </script>
  </body>
</html>
